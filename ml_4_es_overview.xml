<form version="1.1">
  <label>ML Discovery Dashboard</label>
  <description>This dashboard will discover and visualize ML related searches information from the local instance</description>
  <search id="full_ml_searches">
    <query>| rest /servicesNS/-/-/saved/searches 
| eval is_enabled = if(disabled=0,"Yes","No") 
| eval is_scheduled_cu = if(is_scheduled=1,"Yes","No") 

| eval ml_search_type=case(search LIKE "%| apply %" OR search LIKE "%|apply %" OR search LIKE "%mltk_findbest%" OR search LIKE "%mltk_apply%", "ml_search_model_apply", search LIKE "% into %" AND search LIKE "%fit %","ml_search_model_gen", search!="*fit*" AND search !="*apply*","normal_search", search=="*fit *" AND search !="*apply*","ml_search_direct" ) 

| rex field=search "into (?&lt;ml_model_name&gt;\w+)" 
| rex field=search "into app:(?&lt;ml_model_name&gt;\w+)" 

| rex field=search "apply (?&lt;ml_model_name&gt;\w+)"
| rex field=search "apply app:(?&lt;ml_model_name&gt;\w+)"
| rex field=search "mltk_findbest\(\"app:(?&lt;ml_model_name&gt;\w+)"
| rex field=search "mltk_apply\(\"app:(?&lt;ml_model_name&gt;\w+)"
| rex field=search "mltk_apply_upper\(\"app:(?&lt;ml_model_name&gt;\w+)"
| rex field=search "mltk_apply_lower\(\"app:(?&lt;ml_model_name&gt;\w+)"

| rex field=search "datamodel\W{1,2}(?&lt;datamodel&gt;\w+)"
| rex field=search "tstats.*?from datamodel=(?&lt;datamodel&gt;\w+)"
| eval datamodel2=case(match(search, "src_dest_tstats"), mvappend("Network_Traffic", "Intrusion_Detection", "Web"), match(search, "(access_tracker|inactive_account_usage)"), "Authentication", match(search, "malware_operations_tracker"), "Malware", match(search, "(primary_functions|listeningports|localprocesses|services)_tracker"), "Application_State", match(search, "useraccounts_tracker"), "Compute_Inventory")
| eval datamodel=mvappend(datamodel, datamodel2)
| eval datamodel=if(datamodel!="",datamodel,"NoDataModelFound")

| table actions ml_search_type ml_model_name datamodel datamodel2 search eai:acl.app eai:acl.owner id is_enabled is_scheduled is_scheduled_cu is_visible next_scheduled_time qualifiedSearch realtime_schedule request.ui_dispatch_app schedule_priority schedule_window splunk_server title description triggered_alert_count updated cron_schedule is_scheduled is_scheduled_cu disabled is_enabled dispatch.earliest_time dispatch.latest_time alert.digest_mode id
| search ml_search_type="ml_*" 

| join type=outer ml_model_name [| rest /servicesNS/-/-/saved/searches 
| eval is_enabled_model_gen = if(disabled=0,"Yes","No") 
| eval is_scheduled_model_gen = if(is_scheduled=1,"Yes","No") 

| eval ml_search_type=case(search LIKE "%| apply %" OR search LIKE "%|apply %", "ml_search_model_apply", search LIKE "% into %" AND search LIKE "%fit %","ml_search_model_gen", search!="*fit*" AND search !="*apply*","normal_search", search=="*fit *" AND search !="*apply*","ml_search_direct" ) 

| rex field=search "into (?&lt;ml_model_name&gt;\w+)" 
| rex field=search "into app:(?&lt;ml_model_name&gt;\w+)" 

| rex field=search "apply (?&lt;ml_model_name&gt;\w+)"
| rex field=search "apply app:(?&lt;ml_model_name&gt;\w+)"
|rename title as model_gen_title
|rename ml_search_type AS type
| table type is_enabled_model_gen is_scheduled_model_gen ml_model_name model_gen_title
| search type="ml_search_model_gen" ]

| join type=outer ml_model_name [| listmodels|rename name AS ml_model_name|rename type AS ml_model_type| table ml_model_name , ml_model_type , app]


| table actions ml_search_type ml_model_name ml_model_type datamodel title model_gen_title is_enabled_model_gen is_scheduled_model_gen search eai:acl.app eai:acl.owner id is_enabled is_scheduled is_scheduled_cu is_visible next_scheduled_time qualifiedSearch realtime_schedule request.ui_dispatch_app schedule_priority schedule_window splunk_server title description triggered_alert_count updated cron_schedule is_scheduled is_scheduled_cu disabled is_enabled dispatch.earliest_time dispatch.latest_time alert.digest_mode id</query>
    <earliest>-7d</earliest>
    <latest>now</latest>
    <sampleRatio>1</sampleRatio>
  </search>
  <search id="mlspl_errors">
    <query>
      index=_* source=*mlspl.log  | rex field=_raw "PID\s(?&lt;pid&gt;\w+)"
| transaction pid maxspan=40s
| search ERROR
    </query>
    <earliest>-7d</earliest>
    <latest>now</latest>
    <sampleRatio>1</sampleRatio>
  </search>
  <search id="ml_executions">
    <query>
 index=_audit sourcetype=audittrail action=search info!="granted" info!="finalize"
|eval is_esRule=if(savedsearch_name like "%Rule", 1,0)
|eval is_tstats=if(search like "%tstats%", 1,0)
|eval is_ml=if(search like "%fit%" OR search like "%apply", 1,0)
|eval is_genLookup=if(savedsearch_name like "%LookupGen", 1,0)
|eval is_dmaSearch=if(search_type="datamodel_acceleration", 1,0)
|eval is_completed=if(info="completed", 1,0)
| where is_ml=1 AND app!="usage_app" AND savedsearch_name!=""
| bin span=1d _time
    </query>
    <earliest>-1d</earliest>
    <latest>now</latest>
    <sampleRatio>1</sampleRatio>
  </search>
  <fieldset submitButton="false"></fieldset>
  <row>
    <panel depends="$dummy_token$">
      <title>Hidden Panel Checking for Parallel coordinates Add-on</title>
      <table>
        <search>
          <done>
            <condition match="'result.count' == &quot;0&quot;">
              <set token="parallel_coordinates_app_missing">1</set>
            </condition>
            <condition>
              <set token="parallel_coordinates_app_installed"></set>
            </condition>
          </done>
          <query>| rest /services/apps/local splunk_server=local | search title="parallel_coordinates_app" | stats count</query>
          <earliest>-24h</earliest>
          <latest>now</latest>
        </search>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title># ML Searches</title>
      <single>
        <search base="full_ml_searches">
          <query>| stats count</query>
        </search>
        <option name="colorBy">value</option>
        <option name="colorMode">none</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x53a051", "0x0877a6", "0xf8be34", "0xf1813f", "0xdc4e41"]</option>
        <option name="rangeValues">[0,30,70,100]</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="unitPosition">after</option>
        <option name="useColors">0</option>
        <option name="useThousandSeparators">1</option>
      </single>
    </panel>
    <panel>
      <title># ML Model Gen Searches</title>
      <single>
        <search base="full_ml_searches">
          <query>|stats dc(model_gen_title)</query>
        </search>
        <option name="colorBy">value</option>
        <option name="colorMode">none</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x53a051", "0x0877a6", "0xf8be34", "0xf1813f", "0xdc4e41"]</option>
        <option name="rangeValues">[0,30,70,100]</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="unitPosition">after</option>
        <option name="useColors">0</option>
        <option name="useThousandSeparators">1</option>
      </single>
    </panel>
    <panel>
      <title># MLSPL Error (7d)</title>
      <single>
        <search base="mlspl_errors">
          <query>| timechart span=1d count
|tail 1|table count</query>
        </search>
        <option name="colorBy">value</option>
        <option name="colorMode">none</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="rangeValues">[0,5,20,50]</option>
        <option name="refresh.display">progressbar</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="unitPosition">after</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <title>ML searches By App</title>
      <chart>
        <search base="full_ml_searches">
          <query>

|stats count by eai:acl.app</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
    <panel>
      <title>ML searches action types (excluding model gen)</title>
      <chart>
        <search base="full_ml_searches">
          <query>|eval actions=if(actions="",alert_type_calculated, actions)
| eval actions=if(actions!="",actions,"Unknown")
|search ml_search_type!="ml_search_model_gen"
|stats count by actions</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
    <panel>
      <title>ML Searches Review Status</title>
      <chart>
        <search>
          <query>index=_audit sourcetype=audittrail (search="*apply *" OR search="*fit *") fully_completed_search=true search_type=scheduled savedsearch_name!=""
| stats count as "# Run" avg(total_run_time) as "Avg Total runtime" avg(event_count) as "AvgEventCount" avg(result_count) as "AvgResults" by savedsearch_name
|eval AvgEventCount=tonumber(AvgEventCount)
|eval AvgResults=tonumber(AvgResults)
| eval "Running Status"=if(AvgEventCount=0,"Needs Review","OK")
| eval "Running Status"=if(AvgResults&gt;30,"Needs Review","OK")

| stats dc(savedsearch_name) by "Running Status"</query>
          <earliest>-7d@h</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
    <panel>
      <title>ML searches active status</title>
      <chart>
        <search base="full_ml_searches">
          <query>
| eval is_enabled = if(disabled=0,"Enabled","Disabled")
|stats count by is_enabled</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>ML pipeline (7 days)</title>
      <viz type="parallel_coordinates_app.parallel_coordinates">
        <search>
          <query>index=_audit sourcetype=audittrail (search="*apply *" OR search="*fit *") fully_completed_search=true search_type=scheduled savedsearch_name!=""
| stats count as "# Run" avg(total_run_time) as "Avg runtime" avg(event_count) as "Avg Event count" avg(result_count) as "Avg Results"</query>
          <earliest>-7d@h</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="drilldown">none</option>
        <option name="parallel_coordinates_app.parallel_coordinates.colorMode">categorical</option>
        <option name="parallel_coordinates_app.parallel_coordinates.hideTicks">false</option>
        <option name="parallel_coordinates_app.parallel_coordinates.maxCategories">25</option>
        <option name="parallel_coordinates_app.parallel_coordinates.maxColor">#3fc77a</option>
        <option name="parallel_coordinates_app.parallel_coordinates.minColor">#d93f3c</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </viz>
    </panel>
  </row>
  <row>
    <panel>
      <title>Avg Execution time by search</title>
      <chart>
        <search>
          <query>|tstats summariesonly=true count avg(Search_Activity.total_run_time) as total_run_time values(Search_Activity.info) from datamodel=Splunk_Audit.Search_Activity where Search_Activity.info="*" OR Search_Activity.info="finalized" by _time span=1d Search_Activity.savedsearch_name Search_Activity.search 
| rename Search_Activity.savedsearch_name as savedsearch_name , Search_Activity.search as search 
|eval is_ml=if(search like "%fit%" OR search like "%apply%", 1,0)

| search is_ml=1 AND ( savedsearch_name!="" AND savedsearch_name!="search*" AND savedsearch_name!="full_ml_searches" AND savedsearch_name!="ml_executions") 
| bin span=1d _time
|eval is_ml=if(search like "%fit%" OR search like "%apply%", 1,0)
| search is_ml=1 AND ( savedsearch_name!="" AND savedsearch_name!="search*" AND savedsearch_name!="full_ml_searches" AND savedsearch_name!="ml_executions") 
| bin span=1d _time 
| timechart useother=t avg(total_run_time) by savedsearch_name</query>
          <earliest>-7d</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-45</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.text"># sec</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
    <panel>
      <title>Avg Execution time (24h)</title>
      <single>
        <search>
          <query>|tstats summariesonly=true count avg(Search_Activity.total_run_time) as total_run_time values(Search_Activity.info) from datamodel=Splunk_Audit.Search_Activity where Search_Activity.info="*" OR Search_Activity.info="finalized" by _time span=1d Search_Activity.savedsearch_name Search_Activity.search 
| rename Search_Activity.savedsearch_name as savedsearch_name , Search_Activity.search as search 
|eval is_ml=if(search like "%fit%" OR search like "%apply%", 1,0)

| search is_ml=1 AND ( savedsearch_name!="" AND savedsearch_name!="search*" AND savedsearch_name!="full_ml_searches" AND savedsearch_name!="ml_executions") 
| bin span=1d _time
| stats avg(total_run_time)</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0.0</option>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="rangeValues">[5,10,20,50]</option>
        <option name="refresh.display">progressbar</option>
        <option name="unit">sec</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>ML searches count (7d)</title>
      <chart>
        <search>
          <query>|tstats summariesonly=true count from datamodel=Splunk_Audit.Search_Activity where Search_Activity.info="*" OR Search_Activity.info="finalized" by _time span=1d Search_Activity.savedsearch_name Search_Activity.search Search_Activity.info
| rename Search_Activity.savedsearch_name as savedsearch_name , Search_Activity.search as search , Search_Activity.total_run_time as total_run_time
|eval is_ml=if(search like "%fit%" OR search like "%apply", 1,0)
| search is_ml=1 AND (savedsearch_name!="" AND savedsearch_name!="search*" AND savedsearch_name!="full_ml_searches" AND savedsearch_name!="ml_executions")
| timechart count by Search_Activity.info</query>
          <earliest>-7d</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-45</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.text"># sec</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">area</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>ML searches execution metrics (7 days)</title>
      <viz type="parallel_coordinates_app.parallel_coordinates">
        <search>
          <query>index=_audit sourcetype=audittrail (search="*apply *" OR search="*fit *") fully_completed_search=true search_type=scheduled savedsearch_name!="" savedsearch_name!="search*"
| stats count as "# Run" avg(total_run_time) as "Avg runtime" avg(event_count) as "Avg Event count" avg(result_count) as "Avg Results" by savedsearch_name</query>
          <earliest>-7d@h</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </viz>
    </panel>
  </row>
  <row>
    <panel>
      <title>Searches Running status</title>
      <table>
        <search>
          <query>index=_audit sourcetype=audittrail (search="*apply *" OR search="*fit *") fully_completed_search=true search_type=scheduled savedsearch_name!="" savedsearch_name!="search*"
| stats count as "# Run" avg(total_run_time) as "AvgTotalRuntime" avg(event_count) as "AvgEventCount" avg(result_count) as "AvgResults" by savedsearch_name
|eval AvgEventCount=tonumber(AvgEventCount)
|eval AvgResults=tonumber(AvgResults)
|eval AvgTotalRuntime=tonumber(AvgTotalRuntime)

| eval "Running Status"=if(AvgEventCount=0,"Needs Review","OK")
| eval "#Events"=if(AvgEventCount=0,"No Data","OK")
| eval "#Results"=if(AvgResults&gt;200,"Needs tuning","OK")
| eval "#ExecutionTime"=if(AvgTotalRuntime&gt;10,"Slow Search","OK")
| dedup savedsearch_name
|table savedsearch_name "Running Status" "#Events" "#Results" "#ExecutionTime"
| sort "Running Status"</query>
          <earliest>-7d@h</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="Running Status">
          <colorPalette type="map">{"Needs Review":#F1813F,"OK":#53A051}</colorPalette>
        </format>
        <format type="color" field="#Events">
          <colorPalette type="map">{"No Data":#F8BE34,"OK":#B6C75A}</colorPalette>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Machine Learning Toolkit Errors and Failed Fit and Apply Searches - Last 7 days</title>
      <chart>
        <search base="mlspl_errors">
          <query>| timechart span=1d count</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-45</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.text">Errors</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">area</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
    <panel>
      <title>ML fit with warnings (24h)</title>
      <table>
        <search>
          <query>index=_audit sourcetype=audittrail tag=error app!="usage_app" savedsearch_name!="" has_error_warn=true
[| rest  /servicesNS/-/-/saved/searches 
| eval is_enabled = if(disabled=0,"Yes","No")
| eval is_scheduled_cu = if(is_scheduled=1,"Yes","No")
|rename title as savedsearch_name
| table savedsearch_name description search eai:acl.app eai:acl.owner schedule_window cron_schedule is_scheduled is_scheduled_cu is_visible disabled is_enabled dispatch.earliest_time dispatch.latest_time
|search search="*fit*" OR search="*apply*" eai:acl.app!="SA-Utils"
|fields savedsearch_name ]
|stats count as warning_count by savedsearch_name
| eval gen_errors = if(warning_count&gt;0,"Warnings","OK")
|sort - warning_count</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">5</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="error_count">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="warning_count">
          <colorPalette type="list">[#118832,#E3723A,#D94E17,#D41F1F,#D41F1F]</colorPalette>
          <scale type="threshold">0,30,70,100</scale>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel depends="$parallel_coordinates_app_missing$">
      <html>
       
        <h1 style="color:OrangeRed">If you see this message, you still need to install <a href="https://splunkbase.splunk.com/app/3137/" target="_blank">Parallel Coordinates - Custom Visualization</a>
        </h1>
        <br/>
     
      </html>
    </panel>
  </row>
  <row>
    <panel depends="$parallel_coordinates_app_installed$">
      <title>ML search relationships</title>
      <viz type="parallel_coordinates_app.parallel_coordinates">
        <search>
          <query>| rest /servicesNS/-/-/saved/searches 
| eval is_enabled = if(disabled=0,"Yes","No") 
| eval is_scheduled_cu = if(is_scheduled=1,"Yes","No") 

| eval ml_search_type=case(search LIKE "%| apply %" OR search LIKE "%|apply %" OR search LIKE "%mltk_findbest%" OR search LIKE "%mltk_apply%", "ml_search_model_apply", search LIKE "% into %" AND search LIKE "%fit %","ml_search_model_gen", search!="*fit*" AND search !="*apply*","normal_search", search=="*fit *" AND search !="*apply*","ml_search_direct" ) 

| rex field=search "into (?&lt;ml_model_name&gt;\w+)" 
| rex field=search "into app:(?&lt;ml_model_name&gt;\w+)" 

| rex field=search "apply (?&lt;ml_model_name&gt;\w+)"
| rex field=search "apply app:(?&lt;ml_model_name&gt;\w+)"
| rex field=search "mltk_findbest\(\"app:(?&lt;ml_model_name&gt;\w+)"
| rex field=search "mltk_apply\(\"app:(?&lt;ml_model_name&gt;\w+)"
| rex field=search "mltk_apply_upper\(\"app:(?&lt;ml_model_name&gt;\w+)"
| rex field=search "mltk_apply_lower\(\"app:(?&lt;ml_model_name&gt;\w+)"

| rex field=search "datamodel\W{1,2}(?&lt;datamodel&gt;\w+)"
| rex field=search "tstats.*?from datamodel=(?&lt;datamodel&gt;\w+)"
| eval datamodel2=case(match(search, "src_dest_tstats"), mvappend("Network_Traffic", "Intrusion_Detection", "Web"), match(search, "(access_tracker|inactive_account_usage)"), "Authentication", match(search, "malware_operations_tracker"), "Malware", match(search, "(primary_functions|listeningports|localprocesses|services)_tracker"), "Application_State", match(search, "useraccounts_tracker"), "Compute_Inventory")
| eval datamodel=mvappend(datamodel, datamodel2)
| eval datamodel=if(datamodel!="",datamodel,"NoDataModelFound")

| table actions ml_search_type ml_model_name datamodel datamodel2 search eai:acl.app eai:acl.owner id is_enabled is_scheduled is_scheduled_cu is_visible next_scheduled_time qualifiedSearch realtime_schedule request.ui_dispatch_app schedule_priority schedule_window splunk_server title description triggered_alert_count updated cron_schedule is_scheduled is_scheduled_cu disabled is_enabled dispatch.earliest_time dispatch.latest_time alert.digest_mode id
| search ml_search_type="ml_*" 

| join type=outer ml_model_name [| rest /servicesNS/-/-/saved/searches 
| eval is_enabled_model_gen = if(disabled=0,"Yes","No") 
| eval is_scheduled_model_gen = if(is_scheduled=1,"Yes","No") 

| eval ml_search_type=case(search LIKE "%| apply %" OR search LIKE "%|apply %", "ml_search_model_apply", search LIKE "% into %" AND search LIKE "%fit %","ml_search_model_gen", search!="*fit*" AND search !="*apply*","normal_search", search=="*fit *" AND search !="*apply*","ml_search_direct" ) 

| rex field=search "into (?&lt;ml_model_name&gt;\w+)" 
| rex field=search "into app:(?&lt;ml_model_name&gt;\w+)" 

| rex field=search "apply (?&lt;ml_model_name&gt;\w+)"
| rex field=search "apply app:(?&lt;ml_model_name&gt;\w+)"
|rename title as model_gen_title
|rename ml_search_type AS type
| table type is_enabled_model_gen is_scheduled_model_gen ml_model_name model_gen_title
| search type="ml_search_model_gen" ]

| join type=outer ml_model_name [| listmodels|rename name AS ml_model_name|rename type AS ml_model_type| table ml_model_name , ml_model_type , app]


| table actions ml_search_type ml_model_name ml_model_type datamodel title model_gen_title is_enabled_model_gen is_scheduled_model_gen search eai:acl.app eai:acl.owner id is_enabled is_scheduled is_scheduled_cu is_visible next_scheduled_time qualifiedSearch realtime_schedule request.ui_dispatch_app schedule_priority schedule_window splunk_server title description triggered_alert_count updated cron_schedule is_scheduled is_scheduled_cu disabled is_enabled dispatch.earliest_time dispatch.latest_time alert.digest_mode id 
| stats count  by title ml_model_name datamodel
|table title ml_model_name datamodel</query>
          <earliest>0</earliest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="drilldown">none</option>
        <option name="parallel_coordinates_app.parallel_coordinates.colorMode">categorical</option>
        <option name="parallel_coordinates_app.parallel_coordinates.hideTicks">false</option>
        <option name="parallel_coordinates_app.parallel_coordinates.maxCategories">25</option>
        <option name="parallel_coordinates_app.parallel_coordinates.maxColor">#3fc77a</option>
        <option name="parallel_coordinates_app.parallel_coordinates.minColor">#d93f3c</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </viz>
    </panel>
  </row>
  <row>
    <panel>
      <title>ML Searches View</title>
      <input type="dropdown" token="empty_model_token" searchWhenChanged="true">
        <label>Show empty models</label>
        <choice value="*">Yes</choice>
        <choice value="No">No</choice>
        <default>Yes</default>
      </input>
      <input type="text" token="main_search_name">
        <label>Search name</label>
        <default>*</default>
      </input>
      <input type="text" token="model_name_search">
        <label>Model name</label>
        <default>*</default>
      </input>
      <input type="text" token="actions_token">
        <label>Actions</label>
        <default>*</default>
        <initialValue>*</initialValue>
      </input>
      <table>
        <search base="full_ml_searches">
          <query>| eval empty_data_model=if(datamodel!="NoDataModelFound","No","Yes")
| search title="$main_search_name$"
| table   title actions ml_search_type ml_model_name ml_model_type  datamodel model_gen_title  is_enabled_model_gen is_scheduled_model_gen is_enabled is_scheduled eai:acl.app updated cron_schedule empty_data_model alert_type_calculated id
|eval alert_type_calculated=if("alert.digest_mode" &gt; "1", "alert","")
|rename title AS "ML_Search_Name"

|search empty_data_model="$empty_model_token$" ml_model_name="$model_name_search$" actions="$actions_token$"
| fields - empty_data_model id alert_type_calculated</query>
        </search>
        <option name="count">5</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="is_enabled_model_gen">
          <colorPalette type="map">{"Yes":#53A051,"No":#F8BE34}</colorPalette>
        </format>
        <format type="color" field="is_scheduled_model_gen">
          <colorPalette type="map">{"Yes":#53A051,"No":#F8BE34}</colorPalette>
        </format>
        <format type="color" field="is_enabled">
          <colorPalette type="map">{"Yes":#53A051,"No":#F8BE34}</colorPalette>
        </format>
        <format type="color" field="is_scheduled">
          <colorPalette type="map">{"0":#F8BE34,"1":#53A051}</colorPalette>
        </format>
        <format type="color" field="model_gen_title">
          <colorPalette type="map"></colorPalette>
        </format>
        <drilldown>
          <link target="_blank">/app/SplunkEnterpriseSecuritySuite/ess_content_management?textFilter=$click.value2$</link>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Available Models</title>
      <table>
        <search>
          <query>| rest /servicesNS/admin/Splunk_ML_Toolkit/mltk/list_models count=0 splunk_server=local | fields + mlspl:model_info.model_name, eai:appName, disabled, mlspl:model_info.algo_name, mlspl:model_info.params.dist, mlspl:model_info.split_by, updated | rename mlspl:model_info.model_name as "Model_Name", eai:appName as "App_Name",  "mlspl:model_info.algo_name" as "Algorithm", "mlspl:model_info.params.dist" as "Distribution", "mlspl:model_info.split_by" as "Splitby"</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
</form>
